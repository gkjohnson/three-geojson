import{V as d,b as Q,c as oe,R as ne,E as se,d as re,e as ae,P as ce,S as le,W as ue,O as he,D as de,A as pe,G as $,a as me,f as we,g as fe,M as X,h as ye,B as Me,C as ge}from"./GeoJSONLoader-BOrNbtGm.js";const Y=6378137,xe=6356752314245179e-9;new d;function Ee(u){const{x:e,y:t,z:i}=u;u.x=i,u.y=e,u.z=t}function Se(u){return-u+Math.PI/2}const Z=new re,w=new d,c=new d,T=new d,f=new Q,m=new Q,O=new oe,a=new se,B=new d,V=new d,j=new d,z=new d,H=new ne,Pe=1e-12,Re=.1,L=0,J=1,K=2;class ze{constructor(e=1,t=1,i=1){this.name="",this.radius=new d(e,t,i)}intersectRay(e,t){return f.makeScale(...this.radius).invert(),O.center.set(0,0,0),O.radius=1,H.copy(e).applyMatrix4(f),H.intersectSphere(O,t)?(f.makeScale(...this.radius),t.applyMatrix4(f),t):null}getEastNorthUpFrame(e,t,i){return this.getEastNorthUpAxes(e,t,B,V,j,z),i.makeBasis(B,V,j).setPosition(z)}getEastNorthUpAxes(e,t,i,n,s,o=z){this.getCartographicToPosition(e,t,0,o),this.getCartographicToNormal(e,t,s),i.set(-o.y,o.x,0).normalize(),n.crossVectors(s,i).normalize()}getAzElRollFromRotationMatrix(e,t,i,n,s=L){return s===J?(a.set(-Math.PI/2,0,0,"XYZ"),m.makeRotationFromEuler(a).premultiply(i)):s===K?(a.set(-Math.PI/2,0,Math.PI,"XYZ"),m.makeRotationFromEuler(a).premultiply(i)):m.copy(i),this.getEastNorthUpFrame(e,t,f).invert(),m.premultiply(f),a.setFromRotationMatrix(m,"ZXY"),n.azimuth=-a.z,n.elevation=a.x,n.roll=a.y,n}getRotationMatrixFromAzElRoll(e,t,i,n,s,o,r=L){return this.getEastNorthUpFrame(e,t,f),a.set(n,s,-i,"ZXY"),o.makeRotationFromEuler(a).premultiply(f).setPosition(0,0,0),r===J?(a.set(Math.PI/2,0,0,"XYZ"),m.makeRotationFromEuler(a),o.multiply(m)):r===K&&(a.set(-Math.PI/2,0,Math.PI,"XYZ"),m.makeRotationFromEuler(a),o.multiply(m)),o}getFrame(e,t,i,n,s,o,r,p=L){return this.getRotationMatrixFromAzElRoll(e,t,i,n,s,r,p),this.getCartographicToPosition(e,t,o,z),r.setPosition(z),r}getCartographicToPosition(e,t,i,n){this.getCartographicToNormal(e,t,w);const s=this.radius;c.copy(w),c.x*=s.x**2,c.y*=s.y**2,c.z*=s.z**2;const o=Math.sqrt(w.dot(c));return c.divideScalar(o),n.copy(c).addScaledVector(w,i)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,c),this.getPositionToNormal(e,w);const i=T.subVectors(e,c);return t.lon=Math.atan2(w.y,w.x),t.lat=Math.asin(w.z),t.height=Math.sign(i.dot(e))*i.length(),t}getCartographicToNormal(e,t,i){return Z.set(1,Se(e),t),i.setFromSpherical(Z).normalize(),Ee(i),i}getPositionToNormal(e,t){const i=this.radius;return t.copy(e),t.x/=i.x**2,t.y/=i.y**2,t.z/=i.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const i=this.radius,n=1/i.x**2,s=1/i.y**2,o=1/i.z**2,r=e.x*e.x*n,p=e.y*e.y*s,M=e.z*e.z*o,g=r+p+M,x=Math.sqrt(1/g),h=c.copy(e).multiplyScalar(x);if(g<Re)return isFinite(x)?t.copy(h):null;const F=T.set(h.x*n*2,h.y*s*2,h.z*o*2);let A=(1-x)*e.length()/(.5*F.length()),k=0,v,D,S,P,R,b,C,N,U,q,W;do{A-=k,S=1/(1+A*n),P=1/(1+A*s),R=1/(1+A*o),b=S*S,C=P*P,N=R*R,U=b*S,q=C*P,W=N*R,v=r*b+p*C+M*N-1,D=r*U*n+p*q*s+M*W*o;const ie=-2*D;k=v/ie}while(Math.abs(v)>Pe);return t.set(e.x*S,e.y*P,e.z*R)}calculateHorizonDistance(e,t){const i=this.calculateEffectiveRadius(e);return Math.sqrt(2*i*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,n=1-this.radius.z**2/t**2,s=e*ae.DEG2RAD,o=Math.sin(s)**2;return t/Math.sqrt(1-n*o)}getPositionElevation(e){this.getPositionToSurfacePoint(e,c);const t=T.subVectors(e,c);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return new this.constructor().copy(this)}}const _=new ze(Y,Y,xe);_.name="WGS84 Earth";const y=new ce(70,window.innerWidth/window.innerHeight,.01,1e3);y.position.x=-2;y.position.y=1;y.position.z=-1;const G=new le,E=new ue({antialias:!0});E.setAnimationLoop(ve);document.body.appendChild(E.domElement);const Fe=new ge,I=new he(y,E.domElement);I.minDistance=1;I.enableDamping=!0;const ee=new de(16777215,2.75);ee.position.set(1,2,0);const Ae=new pe(16777215,1);G.add(ee,Ae);const l=new $;l.rotation.x=-Math.PI/2;G.add(l);const _e=new URL(""+new URL("world-EVCf79-S.geojson",import.meta.url).href,import.meta.url);new me().loadAsync(_e).then(u=>{const e=new URLSearchParams(location.search),t=e.get("country")||"Japan";let i=parseFloat(e.get("thickness")),n=parseFloat(e.get("resolution"))||2.5,s=!!e.get("wireframe");i!==0&&(i=i||1e5*.5);const o=new we(new fe(1,100,50),new X({color:2236962,transparent:!0,opacity:.75,depthWrite:!1,premultipliedAlpha:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));o.scale.copy(_.radius),o.renderOrder=1,l.add(o);const r=new $;r.visible=s,l.add(r),u.polygons.forEach(g=>{const x=g.feature;if(x&&new RegExp(t).test(x.properties.name)){const h=g.getMeshObject({ellipsoid:_,thickness:i,resolution:n});h.material=new X({polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),l.add(h);const F=h.clone();F.material=new ye({color:0,opacity:.15,transparent:!0,depthWrite:!1,wireframe:!0}),r.add(F)}else{const h=g.getLineObject({ellipsoid:_,resolution:n});l.add(h)}});const p=new Me;p.setFromObject(l),p.getCenter(l.position).multiplyScalar(-1);const M=new d;p.getSize(M),l.scale.setScalar(1.5/Math.max(...M)),l.position.multiplyScalar(l.scale.x),console.log(u)});te();window.addEventListener("resize",te);function ve(){I.update(Math.min(Fe.getDelta(),64/1e3)),E.render(G,y),l.rotation.z=window.performance.now()*1e-4}function te(){E.setSize(window.innerWidth,window.innerHeight),E.setPixelRatio(window.devicePixelRatio),y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix()}
